#version 450
// galaxy nebulas
struct PerFrameUniforms
{
    mat4 gViewMat4;
    mat4 gProjectionMat4;
    mat4 gViewProjectionMat4;
    mat4 gCameraMat4;
    mat4 gCameraNoHeadTrackingMat4;
    mat4 gPrevViewProjectionMat4;
    mat4 gThisToPrevViewProjectionMat4;
    mat4 gInverseViewMat4;
    mat4 gInverseProjectionMat4;
    mat4 gInverseProjectionSCMat4;
    mat4 gInverseViewProjectionMat4;
    vec4 gInverseWorldUpMatVec4[3];
    vec3 gViewPositionVec3;
    float gfTime;
    vec3 gVREyeInfoVec3;
    float gfPrevTime;
    vec4 gClipPlanesVec4;
    vec4 gMBlurSettingsVec4;
    vec3 gDeJitterVec3;
    int giFrameIndex;
    vec4 gTaaSettingsVec4;
    vec4 gTessSettingsVec4;
    vec4 gShellsSettingsVec4;
    vec4 gFrameBufferSizeVec4;
    vec4 gFoVValuesVec4;
    vec4 gShadowSizeVec4;
    vec3 gShadowProjScaleVec3;
    int giDisableAmbientAllowed;
    vec4 gShadowFadeParamVec4;
};

struct TracingFsFxAndFsMapUniforms
{
    vec4 gTraceOrigin;
    vec4 gTraceDir;
    vec4 gTracePDX;
    vec4 gTracePDY;
    vec4 gTraceScreenCenter;
    vec4 gGoalCenterDir;
    vec4 gGoalCenterPerpU;
    vec4 gGoalCenterPerpV;
    vec4 gAnoStreakConfig1;
    vec4 gAnoStreakConfig2;
    vec4 gAnoStreakConfig3;
    vec4 gGalacticScale;
    vec4 gInterest;
    vec4 gTiming;
    vec4 gScreen;
    vec4 gOriginSS;
    vec4 gSunCoreConfig;
    vec4 gSunCoreColour;
    vec4 gBGCellConfig;
    vec4 gBGColourScales;
    vec4 gBGColourConfig;
    vec4 gBGLensFlareColour;
    vec4 gBGLensFlareSpread;
    vec4 gNebulaeStepRange_AlphaPow;
    vec4 gCompositeControlBVCG;
    vec4 gNebulaeTraceConfig;
    vec4 gVignetteLensFlareConfig;
};

struct ColourPalettes
{
    vec4 gLargeAreaPrimaryLUT[10];
    vec4 gLargeAreaSecondaryLUT[10];
};

struct UniformBuffer
{
    PerFrameUniforms mpPerFrame;
    TracingFsFxAndFsMapUniforms mpGalaxyMapPerMesh;
    ColourPalettes mpColourPalettesPerMesh;
};

// Vk3DVision (http://3dsurroundgaming.com/) - Stereo Injection
layout(set = 0, binding = 45, std140) uniform Vk3DParams
{
    vec4 stereo;
    vec4 custom_params;
} vk3d_params;

layout(set = 0, binding = 0, std140) uniform lUniforms_BLK
{
    UniformBuffer lUniforms;
} _329;

layout(set = 1, binding = 0) uniform sampler2D gNoiseMap;

layout(location = 0) in VertexBlock
{
    vec2 mTexCoordsVec2;
} In;

layout(location = 0) out vec4 out_color0;

float _4692;

void main()
{

vec2 tex = In.mTexCoordsVec2;
tex.x -= vk3d_params.stereo.x * 0.5;

    vec2 _1317 = vec2(tex.x, 1.0 - In.mTexCoordsVec2.y);
    vec2 _4653;
    if (_329.lUniforms.mpPerFrame.gFoVValuesVec4.z == 2.0)
    {
        vec2 _4445 = _1317;
        _4445.x = (In.mTexCoordsVec2.x - _329.lUniforms.mpPerFrame.gVREyeInfoVec3.y) * _329.lUniforms.mpPerFrame.gVREyeInfoVec3.z;
        _4653 = _4445;
    }
    else
    {
        _4653 = _1317;
    }
    vec3 _1341 = normalize(((_329.lUniforms.mpGalaxyMapPerMesh.gTracePDX.xyz * (1.0 - _4653.x)) + _329.lUniforms.mpGalaxyMapPerMesh.gTraceScreenCenter.xyz) + (_329.lUniforms.mpGalaxyMapPerMesh.gTracePDY.xyz * (1.0 - _4653.y)));
    vec3 _1029 = _329.lUniforms.mpGalaxyMapPerMesh.gGalacticScale.xyz * 100.0;
    vec4 _4655;
    float _4656;
    _4656 = fract(sin(vec3(dot(_1341.xy, vec2(127.09999847412109375, 311.70001220703125)), _4692, _4692)) * 43758.546875).x * 0.01568627543747425079345703125;
    _4655 = vec4(0.0);
    vec4 _4674;
    for (int _4654 = 0; _4654 < 50; _4656 += max(_329.lUniforms.mpGalaxyMapPerMesh.gNebulaeStepRange_AlphaPow.x, _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeStepRange_AlphaPow.y * _4656), _4655 = _4674, _4654++)
    {
        if (_4655.w > 0.9900000095367431640625)
        {
            break;
        }
        vec3 _1442 = _1029 + (_1341 * _4656);
        vec3 _1688 = _1442 * 2.5;
        vec3 _1724 = floor(_1688);
        vec3 _1726 = fract(_1688);
        vec3 _1734 = (_1726 * _1726) * (vec3(3.0) - (_1726 * 2.0));
        vec4 _1751 = textureLod(gNoiseMap, (((_1724.xy + (vec2(37.0, 17.0) * _1724.z)) + _1734.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        vec3 _1694 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_1688 * 2.019999980926513671875);
        vec3 _1768 = floor(_1694);
        vec3 _1770 = fract(_1694);
        vec3 _1778 = (_1770 * _1770) * (vec3(3.0) - (_1770 * 2.0));
        vec4 _1795 = textureLod(gNoiseMap, (((_1768.xy + (vec2(37.0, 17.0) * _1768.z)) + _1778.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        vec3 _1702 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_1694 * 2.0299999713897705078125);
        vec3 _1812 = floor(_1702);
        vec3 _1814 = fract(_1702);
        vec3 _1822 = (_1814 * _1814) * (vec3(3.0) - (_1814 * 2.0));
        vec4 _1839 = textureLod(gNoiseMap, (((_1812.xy + (vec2(37.0, 17.0) * _1812.z)) + _1822.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        vec3 _1710 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_1702 * 2.0099999904632568359375);
        vec3 _1856 = floor(_1710);
        vec3 _1858 = fract(_1710);
        vec3 _1866 = (_1858 * _1858) * (vec3(3.0) - (_1858 * 2.0));
        vec4 _1883 = textureLod(gNoiseMap, (((_1856.xy + (vec2(37.0, 17.0) * _1856.z)) + _1866.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        float _1717 = clamp((((0.5 * ((-1.0) + (mix(_1751.y, _1751.x, _1734.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_1795.y, _1795.x, _1778.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_1839.y, _1839.x, _1822.z) * 2.0)))) + (0.0625 * ((-1.0) + (mix(_1883.y, _1883.x, _1866.z) * 2.0))), 0.0, 1.0);
        if (_1717 != 0.0)
        {
            vec3 _1901 = (_1442 * _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.y) * 2.5;
            vec3 _1929 = floor(_1901);
            vec3 _1931 = fract(_1901);
            vec3 _1939 = (_1931 * _1931) * (vec3(3.0) - (_1931 * 2.0));
            vec4 _1956 = textureLod(gNoiseMap, (((_1929.xy + (vec2(37.0, 17.0) * _1929.z)) + _1939.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _1907 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_1901 * 2.019999980926513671875);
            vec3 _1973 = floor(_1907);
            vec3 _1975 = fract(_1907);
            vec3 _1983 = (_1975 * _1975) * (vec3(3.0) - (_1975 * 2.0));
            vec4 _2000 = textureLod(gNoiseMap, (((_1973.xy + (vec2(37.0, 17.0) * _1973.z)) + _1983.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _1915 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_1907 * 2.0299999713897705078125);
            vec3 _2017 = floor(_1915);
            vec3 _2019 = fract(_1915);
            vec3 _2027 = (_2019 * _2019) * (vec3(3.0) - (_2019 * 2.0));
            vec4 _2044 = textureLod(gNoiseMap, (((_2017.xy + (vec2(37.0, 17.0) * _2017.z)) + _2027.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _1922 = clamp(((0.5 * ((-1.0) + (mix(_1956.y, _1956.x, _1939.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_2000.y, _2000.x, _1983.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_2044.y, _2044.x, _2027.z) * 2.0))), 0.0, 1.0);
            vec3 _1456 = _1442 * _329.lUniforms.mpGalaxyMapPerMesh.gBGCellConfig.w;
            vec3 _2068 = floor(_1456);
            vec3 _2071 = _1456 - _2068;
            vec3 _2080 = _2068 - (floor(_2068 * 0.0144927538931369781494140625) * 69.0);
            vec3 _2086 = step(_2080, vec3(67.5)) * (_2080 + vec3(1.0));
            vec4 _2096 = vec4(_2080.xy, _2086.xy) + vec4(50.0, 161.0, 50.0, 161.0);
            vec4 _2099 = _2096 * _2096;
            vec4 _2104 = _2099.xzxz * _2099.yyww;
            vec2 _2114 = vec2(1.0) / (vec2(635.2987060546875) + (vec2(_2080.z, _2086.z) * 48.50038909912109375));
            vec3 _2141 = ((_2071 * _2071) * _2071) * ((_2071 * ((_2071 * 6.0) - vec3(15.0))) + vec3(10.0));
            vec4 _2161 = vec4(_2141.xy, vec2(1.0) - _2141.xy);
            float _2177 = _1442.z;
            vec3 _4487 = _1442;
            _4487.z = _2177 + 0.0500000007450580596923828125;
            vec3 _2205 = _4487 * 2.5;
            vec3 _2241 = floor(_2205);
            vec3 _2243 = fract(_2205);
            vec3 _2251 = (_2243 * _2243) * (vec3(3.0) - (_2243 * 2.0));
            vec4 _2268 = textureLod(gNoiseMap, (((_2241.xy + (vec2(37.0, 17.0) * _2241.z)) + _2251.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _2211 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2205 * 2.019999980926513671875);
            vec3 _2285 = floor(_2211);
            vec3 _2287 = fract(_2211);
            vec3 _2295 = (_2287 * _2287) * (vec3(3.0) - (_2287 * 2.0));
            vec4 _2312 = textureLod(gNoiseMap, (((_2285.xy + (vec2(37.0, 17.0) * _2285.z)) + _2295.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _2219 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2211 * 2.0299999713897705078125);
            vec3 _2329 = floor(_2219);
            vec3 _2331 = fract(_2219);
            vec3 _2339 = (_2331 * _2331) * (vec3(3.0) - (_2331 * 2.0));
            vec4 _2356 = textureLod(gNoiseMap, (((_2329.xy + (vec2(37.0, 17.0) * _2329.z)) + _2339.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _2227 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2219 * 2.0099999904632568359375);
            vec3 _2373 = floor(_2227);
            vec3 _2375 = fract(_2227);
            vec3 _2383 = (_2375 * _2375) * (vec3(3.0) - (_2375 * 2.0));
            vec4 _2400 = textureLod(gNoiseMap, (((_2373.xy + (vec2(37.0, 17.0) * _2373.z)) + _2383.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _2185 = 1.0 - clamp((((0.5 * ((-1.0) + (mix(_2268.y, _2268.x, _2251.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_2312.y, _2312.x, _2295.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_2356.y, _2356.x, _2339.z) * 2.0)))) + (0.0625 * ((-1.0) + (mix(_2400.y, _2400.x, _2383.z) * 2.0))), 0.0, 1.0);
            vec3 _4506 = _4487;
            _4506.z = _2177 + 0.100000001490116119384765625;
            vec3 _2418 = _4506 * 2.5;
            vec3 _2446 = floor(_2418);
            vec3 _2448 = fract(_2418);
            vec3 _2456 = (_2448 * _2448) * (vec3(3.0) - (_2448 * 2.0));
            vec4 _2473 = textureLod(gNoiseMap, (((_2446.xy + (vec2(37.0, 17.0) * _2446.z)) + _2456.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _2424 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2418 * 2.019999980926513671875);
            vec3 _2490 = floor(_2424);
            vec3 _2492 = fract(_2424);
            vec3 _2500 = (_2492 * _2492) * (vec3(3.0) - (_2492 * 2.0));
            vec4 _2517 = textureLod(gNoiseMap, (((_2490.xy + (vec2(37.0, 17.0) * _2490.z)) + _2500.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _2432 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2424 * 2.0299999713897705078125);
            vec3 _2534 = floor(_2432);
            vec3 _2536 = fract(_2432);
            vec3 _2544 = (_2536 * _2536) * (vec3(3.0) - (_2536 * 2.0));
            vec4 _2561 = textureLod(gNoiseMap, (((_2534.xy + (vec2(37.0, 17.0) * _2534.z)) + _2544.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _2578 = clamp(dot(mix(fract(_2104 * _2114.xxxx), fract(_2104 * _2114.yyyy), vec4(_2141.z)), _2161.zxzx * _2161.wwyy), 0.0, 1.0) * 9.0;
            int _2583 = int(floor(_2578));
            int _2586 = int(ceil(_2578));
            vec3 _2596 = vec3(fract(_2578));
            float _1482 = (_1717 * clamp(_329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.w + (_1922 * _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.z), 0.0, 1.0)) * _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.x;
            _4674 = _4655 + (vec4((mix(mix(_329.lUniforms.mpColourPalettesPerMesh.gLargeAreaPrimaryLUT[_2583].xyz, _329.lUniforms.mpColourPalettesPerMesh.gLargeAreaPrimaryLUT[_2586].xyz, _2596), mix(_329.lUniforms.mpColourPalettesPerMesh.gLargeAreaSecondaryLUT[_2583].xyz, _329.lUniforms.mpColourPalettesPerMesh.gLargeAreaSecondaryLUT[_2586].xyz, _2596), vec3(smoothstep(-1.0, 1.0, _1922))) * mix(vec3(0.086000002920627593994140625, 0.086000002920627593994140625, 0.08900000154972076416015625), vec3(1.0), vec3(_2185 - (clamp(((0.5 * ((-1.0) + (mix(_2473.y, _2473.x, _2456.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_2517.y, _2517.x, _2500.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_2561.y, _2561.x, _2544.z) * 2.0))), 0.0, 1.0) * _2185)))) * _1482, _1482) * (1.0 - _1482));
        }
        else
        {
            _4674 = _4655;
        }
    }
    vec4 _4660;
    float _4662;
    _4662 = _4656;
    _4660 = _4655;
    vec4 _4675;
    for (int _4659 = 0; _4659 < 40; _4662 += max(_329.lUniforms.mpGalaxyMapPerMesh.gNebulaeStepRange_AlphaPow.x, _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeStepRange_AlphaPow.y * _4662), _4660 = _4675, _4659++)
    {
        if (_4660.w > 0.9900000095367431640625)
        {
            break;
        }
        vec3 _1525 = _1029 + (_1341 * _4662);
        vec3 _2619 = _1525 * 2.5;
        vec3 _2647 = floor(_2619);
        vec3 _2649 = fract(_2619);
        vec3 _2657 = (_2649 * _2649) * (vec3(3.0) - (_2649 * 2.0));
        vec4 _2674 = textureLod(gNoiseMap, (((_2647.xy + (vec2(37.0, 17.0) * _2647.z)) + _2657.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        vec3 _2625 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2619 * 2.019999980926513671875);
        vec3 _2691 = floor(_2625);
        vec3 _2693 = fract(_2625);
        vec3 _2701 = (_2693 * _2693) * (vec3(3.0) - (_2693 * 2.0));
        vec4 _2718 = textureLod(gNoiseMap, (((_2691.xy + (vec2(37.0, 17.0) * _2691.z)) + _2701.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        vec3 _2633 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2625 * 2.0299999713897705078125);
        vec3 _2735 = floor(_2633);
        vec3 _2737 = fract(_2633);
        vec3 _2745 = (_2737 * _2737) * (vec3(3.0) - (_2737 * 2.0));
        vec4 _2762 = textureLod(gNoiseMap, (((_2735.xy + (vec2(37.0, 17.0) * _2735.z)) + _2745.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        float _2640 = clamp(((0.5 * ((-1.0) + (mix(_2674.y, _2674.x, _2657.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_2718.y, _2718.x, _2701.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_2762.y, _2762.x, _2745.z) * 2.0))), 0.0, 1.0);
        if (_2640 != 0.0)
        {
            vec3 _2780 = (_1525 * _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.y) * 2.5;
            vec3 _2808 = floor(_2780);
            vec3 _2810 = fract(_2780);
            vec3 _2818 = (_2810 * _2810) * (vec3(3.0) - (_2810 * 2.0));
            vec4 _2835 = textureLod(gNoiseMap, (((_2808.xy + (vec2(37.0, 17.0) * _2808.z)) + _2818.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _2786 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2780 * 2.019999980926513671875);
            vec3 _2852 = floor(_2786);
            vec3 _2854 = fract(_2786);
            vec3 _2862 = (_2854 * _2854) * (vec3(3.0) - (_2854 * 2.0));
            vec4 _2879 = textureLod(gNoiseMap, (((_2852.xy + (vec2(37.0, 17.0) * _2852.z)) + _2862.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _2794 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_2786 * 2.0299999713897705078125);
            vec3 _2896 = floor(_2794);
            vec3 _2898 = fract(_2794);
            vec3 _2906 = (_2898 * _2898) * (vec3(3.0) - (_2898 * 2.0));
            vec4 _2923 = textureLod(gNoiseMap, (((_2896.xy + (vec2(37.0, 17.0) * _2896.z)) + _2906.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _2801 = clamp(((0.5 * ((-1.0) + (mix(_2835.y, _2835.x, _2818.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_2879.y, _2879.x, _2862.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_2923.y, _2923.x, _2906.z) * 2.0))), 0.0, 1.0);
            vec3 _1539 = _1525 * _329.lUniforms.mpGalaxyMapPerMesh.gBGCellConfig.w;
            vec3 _2947 = floor(_1539);
            vec3 _2950 = _1539 - _2947;
            vec3 _2959 = _2947 - (floor(_2947 * 0.0144927538931369781494140625) * 69.0);
            vec3 _2965 = step(_2959, vec3(67.5)) * (_2959 + vec3(1.0));
            vec4 _2975 = vec4(_2959.xy, _2965.xy) + vec4(50.0, 161.0, 50.0, 161.0);
            vec4 _2978 = _2975 * _2975;
            vec4 _2983 = _2978.xzxz * _2978.yyww;
            vec2 _2993 = vec2(1.0) / (vec2(635.2987060546875) + (vec2(_2959.z, _2965.z) * 48.50038909912109375));
            vec3 _3020 = ((_2950 * _2950) * _2950) * ((_2950 * ((_2950 * 6.0) - vec3(15.0))) + vec3(10.0));
            vec4 _3040 = vec4(_3020.xy, vec2(1.0) - _3020.xy);
            float _3056 = _1525.z;
            vec3 _4552 = _1525;
            _4552.z = _3056 + 0.0500000007450580596923828125;
            vec3 _3084 = _4552 * 2.5;
            vec3 _3120 = floor(_3084);
            vec3 _3122 = fract(_3084);
            vec3 _3130 = (_3122 * _3122) * (vec3(3.0) - (_3122 * 2.0));
            vec4 _3147 = textureLod(gNoiseMap, (((_3120.xy + (vec2(37.0, 17.0) * _3120.z)) + _3130.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3090 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3084 * 2.019999980926513671875);
            vec3 _3164 = floor(_3090);
            vec3 _3166 = fract(_3090);
            vec3 _3174 = (_3166 * _3166) * (vec3(3.0) - (_3166 * 2.0));
            vec4 _3191 = textureLod(gNoiseMap, (((_3164.xy + (vec2(37.0, 17.0) * _3164.z)) + _3174.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3098 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3090 * 2.0299999713897705078125);
            vec3 _3208 = floor(_3098);
            vec3 _3210 = fract(_3098);
            vec3 _3218 = (_3210 * _3210) * (vec3(3.0) - (_3210 * 2.0));
            vec4 _3235 = textureLod(gNoiseMap, (((_3208.xy + (vec2(37.0, 17.0) * _3208.z)) + _3218.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3106 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3098 * 2.0099999904632568359375);
            vec3 _3252 = floor(_3106);
            vec3 _3254 = fract(_3106);
            vec3 _3262 = (_3254 * _3254) * (vec3(3.0) - (_3254 * 2.0));
            vec4 _3279 = textureLod(gNoiseMap, (((_3252.xy + (vec2(37.0, 17.0) * _3252.z)) + _3262.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _3064 = 1.0 - clamp((((0.5 * ((-1.0) + (mix(_3147.y, _3147.x, _3130.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_3191.y, _3191.x, _3174.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_3235.y, _3235.x, _3218.z) * 2.0)))) + (0.0625 * ((-1.0) + (mix(_3279.y, _3279.x, _3262.z) * 2.0))), 0.0, 1.0);
            vec3 _4571 = _4552;
            _4571.z = _3056 + 0.100000001490116119384765625;
            vec3 _3297 = _4571 * 2.5;
            vec3 _3325 = floor(_3297);
            vec3 _3327 = fract(_3297);
            vec3 _3335 = (_3327 * _3327) * (vec3(3.0) - (_3327 * 2.0));
            vec4 _3352 = textureLod(gNoiseMap, (((_3325.xy + (vec2(37.0, 17.0) * _3325.z)) + _3335.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3303 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3297 * 2.019999980926513671875);
            vec3 _3369 = floor(_3303);
            vec3 _3371 = fract(_3303);
            vec3 _3379 = (_3371 * _3371) * (vec3(3.0) - (_3371 * 2.0));
            vec4 _3396 = textureLod(gNoiseMap, (((_3369.xy + (vec2(37.0, 17.0) * _3369.z)) + _3379.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3311 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3303 * 2.0299999713897705078125);
            vec3 _3413 = floor(_3311);
            vec3 _3415 = fract(_3311);
            vec3 _3423 = (_3415 * _3415) * (vec3(3.0) - (_3415 * 2.0));
            vec4 _3440 = textureLod(gNoiseMap, (((_3413.xy + (vec2(37.0, 17.0) * _3413.z)) + _3423.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _3457 = clamp(dot(mix(fract(_2983 * _2993.xxxx), fract(_2983 * _2993.yyyy), vec4(_3020.z)), _3040.zxzx * _3040.wwyy), 0.0, 1.0) * 9.0;
            int _3462 = int(floor(_3457));
            int _3465 = int(ceil(_3457));
            vec3 _3475 = vec3(fract(_3457));
            float _1566 = (_2640 * clamp(_329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.w + (_2801 * (_329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.z * 0.980000019073486328125)), 0.0, 1.0)) * _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.x;
            _4675 = _4660 + (vec4((mix(mix(_329.lUniforms.mpColourPalettesPerMesh.gLargeAreaPrimaryLUT[_3462].xyz, _329.lUniforms.mpColourPalettesPerMesh.gLargeAreaPrimaryLUT[_3465].xyz, _3475), mix(_329.lUniforms.mpColourPalettesPerMesh.gLargeAreaSecondaryLUT[_3462].xyz, _329.lUniforms.mpColourPalettesPerMesh.gLargeAreaSecondaryLUT[_3465].xyz, _3475), vec3(smoothstep(-1.0, 1.0, _2801))) * mix(vec3(0.086000002920627593994140625, 0.086000002920627593994140625, 0.08900000154972076416015625), vec3(1.0), vec3(_3064 - (clamp(((0.5 * ((-1.0) + (mix(_3352.y, _3352.x, _3335.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_3396.y, _3396.x, _3379.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_3440.y, _3440.x, _3423.z) * 2.0))), 0.0, 1.0) * _3064)))) * _1566, _1566) * (1.0 - _1566));
        }
        else
        {
            _4675 = _4660;
        }
    }
    vec4 _4667;
    _4667 = _4660;
    vec4 _4676;
    int _4666 = 0;
    float _4669 = _4662;
    for (; _4666 < 30; _4669 += max(_329.lUniforms.mpGalaxyMapPerMesh.gNebulaeStepRange_AlphaPow.x, _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeStepRange_AlphaPow.y * _4669), _4667 = _4676, _4666++)
    {
        if (_4667.w > 0.9900000095367431640625)
        {
            break;
        }
        vec3 _1609 = _1029 + (_1341 * _4669);
        vec3 _3497 = _1609 * 2.5;
        vec3 _3517 = floor(_3497);
        vec3 _3519 = fract(_3497);
        vec3 _3527 = (_3519 * _3519) * (vec3(3.0) - (_3519 * 2.0));
        vec4 _3544 = textureLod(gNoiseMap, (((_3517.xy + (vec2(37.0, 17.0) * _3517.z)) + _3527.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        vec3 _3503 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3497 * 2.019999980926513671875);
        vec3 _3561 = floor(_3503);
        vec3 _3563 = fract(_3503);
        vec3 _3571 = (_3563 * _3563) * (vec3(3.0) - (_3563 * 2.0));
        vec4 _3588 = textureLod(gNoiseMap, (((_3561.xy + (vec2(37.0, 17.0) * _3561.z)) + _3571.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
        float _3510 = clamp((0.5 * ((-1.0) + (mix(_3544.y, _3544.x, _3527.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_3588.y, _3588.x, _3571.z) * 2.0))), 0.0, 1.0);
        if (_3510 != 0.0)
        {
            vec3 _3606 = (_1609 * _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.y) * 2.5;
            vec3 _3634 = floor(_3606);
            vec3 _3636 = fract(_3606);
            vec3 _3644 = (_3636 * _3636) * (vec3(3.0) - (_3636 * 2.0));
            vec4 _3661 = textureLod(gNoiseMap, (((_3634.xy + (vec2(37.0, 17.0) * _3634.z)) + _3644.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3612 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3606 * 2.019999980926513671875);
            vec3 _3678 = floor(_3612);
            vec3 _3680 = fract(_3612);
            vec3 _3688 = (_3680 * _3680) * (vec3(3.0) - (_3680 * 2.0));
            vec4 _3705 = textureLod(gNoiseMap, (((_3678.xy + (vec2(37.0, 17.0) * _3678.z)) + _3688.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3620 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3612 * 2.0299999713897705078125);
            vec3 _3722 = floor(_3620);
            vec3 _3724 = fract(_3620);
            vec3 _3732 = (_3724 * _3724) * (vec3(3.0) - (_3724 * 2.0));
            vec4 _3749 = textureLod(gNoiseMap, (((_3722.xy + (vec2(37.0, 17.0) * _3722.z)) + _3732.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _3627 = clamp(((0.5 * ((-1.0) + (mix(_3661.y, _3661.x, _3644.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_3705.y, _3705.x, _3688.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_3749.y, _3749.x, _3732.z) * 2.0))), 0.0, 1.0);
            vec3 _1623 = _1609 * _329.lUniforms.mpGalaxyMapPerMesh.gBGCellConfig.w;
            vec3 _3773 = floor(_1623);
            vec3 _3776 = _1623 - _3773;
            vec3 _3785 = _3773 - (floor(_3773 * 0.0144927538931369781494140625) * 69.0);
            vec3 _3791 = step(_3785, vec3(67.5)) * (_3785 + vec3(1.0));
            vec4 _3801 = vec4(_3785.xy, _3791.xy) + vec4(50.0, 161.0, 50.0, 161.0);
            vec4 _3804 = _3801 * _3801;
            vec4 _3809 = _3804.xzxz * _3804.yyww;
            vec2 _3819 = vec2(1.0) / (vec2(635.2987060546875) + (vec2(_3785.z, _3791.z) * 48.50038909912109375));
            vec3 _3846 = ((_3776 * _3776) * _3776) * ((_3776 * ((_3776 * 6.0) - vec3(15.0))) + vec3(10.0));
            vec4 _3866 = vec4(_3846.xy, vec2(1.0) - _3846.xy);
            float _3882 = _1609.z;
            vec3 _4613 = _1609;
            _4613.z = _3882 + 0.0500000007450580596923828125;
            vec3 _3910 = _4613 * 2.5;
            vec3 _3946 = floor(_3910);
            vec3 _3948 = fract(_3910);
            vec3 _3956 = (_3948 * _3948) * (vec3(3.0) - (_3948 * 2.0));
            vec4 _3973 = textureLod(gNoiseMap, (((_3946.xy + (vec2(37.0, 17.0) * _3946.z)) + _3956.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3916 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3910 * 2.019999980926513671875);
            vec3 _3990 = floor(_3916);
            vec3 _3992 = fract(_3916);
            vec3 _4000 = (_3992 * _3992) * (vec3(3.0) - (_3992 * 2.0));
            vec4 _4017 = textureLod(gNoiseMap, (((_3990.xy + (vec2(37.0, 17.0) * _3990.z)) + _4000.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3924 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3916 * 2.0299999713897705078125);
            vec3 _4034 = floor(_3924);
            vec3 _4036 = fract(_3924);
            vec3 _4044 = (_4036 * _4036) * (vec3(3.0) - (_4036 * 2.0));
            vec4 _4061 = textureLod(gNoiseMap, (((_4034.xy + (vec2(37.0, 17.0) * _4034.z)) + _4044.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _3932 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_3924 * 2.0099999904632568359375);
            vec3 _4078 = floor(_3932);
            vec3 _4080 = fract(_3932);
            vec3 _4088 = (_4080 * _4080) * (vec3(3.0) - (_4080 * 2.0));
            vec4 _4105 = textureLod(gNoiseMap, (((_4078.xy + (vec2(37.0, 17.0) * _4078.z)) + _4088.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _3890 = 1.0 - clamp((((0.5 * ((-1.0) + (mix(_3973.y, _3973.x, _3956.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_4017.y, _4017.x, _4000.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_4061.y, _4061.x, _4044.z) * 2.0)))) + (0.0625 * ((-1.0) + (mix(_4105.y, _4105.x, _4088.z) * 2.0))), 0.0, 1.0);
            vec3 _4632 = _4613;
            _4632.z = _3882 + 0.100000001490116119384765625;
            vec3 _4123 = _4632 * 2.5;
            vec3 _4151 = floor(_4123);
            vec3 _4153 = fract(_4123);
            vec3 _4161 = (_4153 * _4153) * (vec3(3.0) - (_4153 * 2.0));
            vec4 _4178 = textureLod(gNoiseMap, (((_4151.xy + (vec2(37.0, 17.0) * _4151.z)) + _4161.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _4129 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_4123 * 2.019999980926513671875);
            vec3 _4195 = floor(_4129);
            vec3 _4197 = fract(_4129);
            vec3 _4205 = (_4197 * _4197) * (vec3(3.0) - (_4197 * 2.0));
            vec4 _4222 = textureLod(gNoiseMap, (((_4195.xy + (vec2(37.0, 17.0) * _4195.z)) + _4205.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            vec3 _4137 = mat3(vec3(0.0, 0.800000011920928955078125, 0.60000002384185791015625), vec3(-0.800000011920928955078125, 0.36000001430511474609375, -0.4799999892711639404296875), vec3(-0.60000002384185791015625, -0.4799999892711639404296875, 0.63999998569488525390625)) * (_4129 * 2.0299999713897705078125);
            vec3 _4239 = floor(_4137);
            vec3 _4241 = fract(_4137);
            vec3 _4249 = (_4241 * _4241) * (vec3(3.0) - (_4241 * 2.0));
            vec4 _4266 = textureLod(gNoiseMap, (((_4239.xy + (vec2(37.0, 17.0) * _4239.z)) + _4249.xy) + vec2(0.5)) * vec2(0.00390625), 0.0);
            float _4283 = clamp(dot(mix(fract(_3809 * _3819.xxxx), fract(_3809 * _3819.yyyy), vec4(_3846.z)), _3866.zxzx * _3866.wwyy), 0.0, 1.0) * 9.0;
            int _4288 = int(floor(_4283));
            int _4291 = int(ceil(_4283));
            vec3 _4301 = vec3(fract(_4283));
            float _1650 = (_3510 * clamp(_329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.w + (_3627 * (_329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.z * 0.959999978542327880859375)), 0.0, 1.0)) * _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeTraceConfig.x;
            _4676 = _4667 + (vec4((mix(mix(_329.lUniforms.mpColourPalettesPerMesh.gLargeAreaPrimaryLUT[_4288].xyz, _329.lUniforms.mpColourPalettesPerMesh.gLargeAreaPrimaryLUT[_4291].xyz, _4301), mix(_329.lUniforms.mpColourPalettesPerMesh.gLargeAreaSecondaryLUT[_4288].xyz, _329.lUniforms.mpColourPalettesPerMesh.gLargeAreaSecondaryLUT[_4291].xyz, _4301), vec3(smoothstep(-1.0, 1.0, _3627))) * mix(vec3(0.086000002920627593994140625, 0.086000002920627593994140625, 0.08900000154972076416015625), vec3(1.0), vec3(_3890 - (clamp(((0.5 * ((-1.0) + (mix(_4178.y, _4178.x, _4161.z) * 2.0))) + (0.25 * ((-1.0) + (mix(_4222.y, _4222.x, _4205.z) * 2.0)))) + (0.125 * ((-1.0) + (mix(_4266.y, _4266.x, _4249.z) * 2.0))), 0.0, 1.0) * _3890)))) * _1650, _1650) * (1.0 - _1650));
        }
        else
        {
            _4676 = _4667;
        }
    }
    vec4 _1256 = mix(clamp(_4667, vec4(0.0), vec4(1.0)), _329.lUniforms.mpGalaxyMapPerMesh.gSunCoreColour, vec4(clamp((1.0 / (length(vec2(-dot(_329.lUniforms.mpGalaxyMapPerMesh.gGoalCenterPerpU.xyz, _1341), dot(_329.lUniforms.mpGalaxyMapPerMesh.gGoalCenterPerpV.xyz, _1341))) * ((mix(_329.lUniforms.mpGalaxyMapPerMesh.gSunCoreConfig.x, _329.lUniforms.mpGalaxyMapPerMesh.gSunCoreConfig.y, _329.lUniforms.mpGalaxyMapPerMesh.gInterest.z) * 2.0) * (1.5 - _329.lUniforms.mpGalaxyMapPerMesh.gGoalCenterDir.w)))) * (_329.lUniforms.mpGalaxyMapPerMesh.gSunCoreConfig.w * clamp(dot(_329.lUniforms.mpGalaxyMapPerMesh.gGoalCenterDir.xyz, _1341), 0.0, 1.0)), 0.0, 1.0)));
    vec4 _4652 = _1256;
    _4652.w = pow(_1256.w, _329.lUniforms.mpGalaxyMapPerMesh.gNebulaeStepRange_AlphaPow.z);
    out_color0 = _4652;
}


